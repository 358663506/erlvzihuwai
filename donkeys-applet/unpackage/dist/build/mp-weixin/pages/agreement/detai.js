(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/agreement/detai"],{"04db":function(e,n,t){"use strict";(function(e){t("1354");o(t("66fd"));var n=o(t("1c60"));function o(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=t,e(n.default)}).call(this,t("543d")["createPage"])},"1c60":function(e,n,t){"use strict";t.r(n);var o=t("6008"),a=t("3fbb");for(var i in a)"default"!==i&&function(e){t.d(n,e,(function(){return a[e]}))}(i);t("ba47");var r,s=t("f0c5"),u=Object(s["a"])(a["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],r);n["default"]=u.exports},"3fbb":function(e,n,t){"use strict";t.r(n);var o=t("f193"),a=t.n(o);for(var i in o)"default"!==i&&function(e){t.d(n,e,(function(){return o[e]}))}(i);n["default"]=a.a},6008:function(e,n,t){"use strict";t.d(n,"b",(function(){return a})),t.d(n,"c",(function(){return i})),t.d(n,"a",(function(){return o}));var o={mpHtml:function(){return Promise.all([t.e("common/vendor"),t.e("components/mp-html/mp-html")]).then(t.bind(null,"0809"))},uLoading:function(){return t.e("uview-ui/components/u-loading/u-loading").then(t.bind(null,"f3a1"))}},a=function(){var e=this,n=e.$createElement;e._self._c},i=[]},aeeb:function(e,n,t){},ba47:function(e,n,t){"use strict";var o=t("aeeb"),a=t.n(o);a.a},f193:function(e,n,t){"use strict";(function(e){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=i(t("a34a")),a=t("e211");function i(e){return e&&e.__esModule?e:{default:e}}function r(e,n,t,o,a,i,r){try{var s=e[i](r),u=s.value}catch(c){return void t(c)}s.done?n(u):Promise.resolve(u).then(o,a)}function s(e){return function(){var n=this,t=arguments;return new Promise((function(o,a){var i=e.apply(n,t);function s(e){r(i,o,a,s,u,"next",e)}function u(e){r(i,o,a,s,u,"throw",e)}s(void 0)}))}}var u,c=null,d=[],f=0,g=0;e.getSystemInfo({success:function(e){f=e.windowWidth,g=e.windowHeight}});var l=function(){t.e("components/qianxiao-pop/qianxiao-pop").then(function(){return resolve(t("336b"))}.bind(null,t)).catch(t.oe)},h={components:{myPopup:l},computed:{token:function(){return this.$store.state.token},userInfo:function(){return this.$store.state.userInfo},loadingSize:function(){return e.upx2px(120)},showLoading:function(){return this.$store.state.loading}},watch:{token:function(e){e&&(this.getAgreementInfo(),this.getAutographInfo())}},data:function(){return{isLoad:!1,agreementId:"",signImage1:"",signImage2:"",signImageKey:"signImage1",isEnd:!1,agreementInfo:{title:"",content:""},autographInfo:{},tagStyle:{table:"box-sizing: border-box; border-top: 1px solid #dfe2e5; border-left: 1px solid #dfe2e5;",th:"border-right: 1px solid #dfe2e5; border-bottom: 1px solid #dfe2e5;",td:"border-right: 1px solid #dfe2e5; border-bottom: 1px solid #dfe2e5;",li:"margin: 5px 0;"}}},onLoad:function(n){u=this,c=e.createCanvasContext("firstCanvas",u),n.id?(this.agreementId=n.id,this.getAgreementInfo(),this.getAutographInfo()):e.showToast({title:"未知错误！",icon:"none"})},onShareAppMessage:function(){return{title:this.agreementInfo.title,path:"/pages/agreement/detai?id="+this.agreementId}},methods:{getAgreementInfo:function(){var e=this;this.$store.state.loading=!0,(0,a.getAgreementInfo)({id:this.agreementId}).then((function(n){e.agreementInfo=n.data})).finally((function(){e.isLoad=!0,e.$store.state.loading=!1}))},getAutographInfo:function(){var e=this;(0,a.getAutographInfo)({agreementId:this.agreementId}).then((function(n){var t=n.data.id?n.data:{content:""};e.signImage1=t.content.split(",")[0],e.signImage2=t.content.split(",")[1],e.autographInfo=t}))},addAutograph:function(e){var n=this,t=this;return new Promise((function(o,i){var r;n.$store.state.loading=!0,r=n.autographInfo.id?(0,a.updateAutograph)({id:n.autographInfo.id,agreementId:n.agreementInfo.id,content:e}):(0,a.addAutograph)({content:e,agreementId:t.agreementId}),Promise.resolve(r).then((function(e){o(e.data)})).catch((function(e){i(e)})).finally((function(){n.$store.state.loading=!1}))}))},hideShow:function(){console.log("333"),u.$refs.pop.hide()},showSign:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.signImageKey=1==e?"signImage1":"signImage2",u.$refs.pop.show()},overSign:function(){u.isEnd?e.canvasToTempFilePath({canvasId:"firstCanvas",success:function(){var e=s(o.default.mark((function e(n){var t,i,r;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=u.signImage1,i=u.signImage2,e.next=4,(0,a.imgUpload)(n.tempFilePath,"autograph");case 4:if(r=e.sent,"signImage1"==u.signImageKey?t=r:i=r,"signImage2"!=u.signImageKey&&!i){e.next=11;break}return e.next=9,u.addAutograph(t+","+i);case 9:e.next=13;break;case 11:return e.next=13,u.addAutograph(t);case 13:u.signImage1=t,u.signImage2=i,u.hideShow(),u.clearClick();case 17:case"end":return e.stop()}}),e)})));function n(n){return e.apply(this,arguments)}return n}()}):e.showToast({title:"请先完成签名",icon:"none",duration:1500,mask:!0})},start:function(e){var n={x:e.changedTouches[0].x,y:e.changedTouches[0].y};d.push(n)},move:function(e){var n={x:e.touches[0].x,y:e.touches[0].y};d.push(n),d.length>=2&&this.draw(d)},end:function(e){this.isEnd=!0,console.log("end"),d.pop()},cancel:function(e){},tap:function(e){},error:function(e){},draw:function(e){var n=e[0],t=e[1];e.shift(),c.setStrokeStyle("#000"),c.setLineWidth(5),c.setLineCap("round"),c.setLineJoin("round"),c.moveTo(n.x,n.y),c.lineTo(t.x,t.y),c.stroke(),c.draw(!0)},clearClick:function(){this.isEnd=!1,c.clearRect(0,0,f,g),c.draw(!0)}}};n.default=h}).call(this,t("543d")["default"])}},[["04db","common/runtime","common/vendor"]]]);