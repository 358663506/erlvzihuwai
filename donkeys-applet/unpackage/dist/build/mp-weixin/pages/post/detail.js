(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/post/detail"],{"299f":function(t,e,n){"use strict";(function(t){n("1354");o(n("66fd"));var e=o(n("a83c"));function o(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=n,t(e.default)}).call(this,n("543d")["createPage"])},"5d1c":function(t,e,n){"use strict";var o=n("f98b"),i=n.n(o);i.a},"5f4c":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=a(n("a34a")),i=n("e211"),r=n("dd17"),s=a(n("c9c7"));function a(t){return t&&t.__esModule?t:{default:t}}function u(t,e,n,o,i,r,s){try{var a=t[r](s),u=a.value}catch(c){return void n(c)}a.done?e(u):Promise.resolve(u).then(o,i)}function c(t){return function(){var e=this,n=arguments;return new Promise((function(o,i){var r=t.apply(e,n);function s(t){u(r,o,i,s,a,"next",t)}function a(t){u(r,o,i,s,a,"throw",t)}s(void 0)}))}}function l(t){return p(t)||h(t)||d(t)||f()}function f(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function d(t,e){if(t){if("string"===typeof t)return m(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(t,e):void 0}}function h(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function p(t){if(Array.isArray(t))return m(t)}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function g(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?g(Object(n),!0).forEach((function(e){b(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function b(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var v={filters:{dateMonth:function(t){return t?(0,s.default)(t).format("YYYY年MM月DD日"):""}},computed:{loadingSize:function(){return t.upx2px(120)},showLoading:function(){return this.$store.state.loading},uIconSize:function(){return t.upx2px(60)},html:function(){var t=this.postInfo||{};return t.content||""},isAdmin:function(){return 0===this.$store.state.userInfo.role},replyTotalAll:function(){var t=this.replyTotal;return this.replyList.forEach((function(e){t+=e.replys.length})),t},token:function(){return this.$store.state.token},showCommenBar:function(){var t=this.postInfo||{};return 1===t.isReply}},watch:{token:function(){this.init()}},data:function(){return{postStatusText:["隐藏","报名中","结束报名","活动开始","活动取消","活动结束"],postStatusClass:["bg-black","bg-green","bg-purple","bg-blue","bg-red","bg-gray"],isLoad:!1,loadStatus:"loading",postId:null,postInfo:{},tagStyle:{table:"box-sizing: border-box; border-top: 1px solid #dfe2e5; border-left: 1px solid #dfe2e5;",th:"border-right: 1px solid #dfe2e5; border-bottom: 1px solid #dfe2e5;",td:"border-right: 1px solid #dfe2e5; border-bottom: 1px solid #dfe2e5;",li:"margin: 5px 0;"},lickInfo:null,replySearchForm:{page:1,size:15},replyList:[],replyTotal:0,showAddComment:!1,addCommentFocus:!1,commentContent:"",replyCommentId:0,replyNickname:"",page_index:1,page_size:10,hasMoreData:!1,showShareTip:!1,showH5Share:!1,showBrowserShareTip:!1}},onShareAppMessage:function(){return{title:this.postInfo.title,path:"/pages/post/detail?id="+this.postId}},onLoad:function(e){this.$store.state.refreshPost=!1,e.id?(this.postId=e.id,this.getPostInfo(e.id),this.getReplyPage(y(y({},this.replySearchForm),{},{postId:e.id})),this.init()):t.showToast({title:"未知错误！",icon:"none"})},onShow:function(){this.$store.state.refreshPostDetail&&(this.$store.state.refreshPostDetail=!1,this.getPostInfo(this.postId))},onReachBottom:function(){"loadmore"===this.loadStatus&&this.onLoadMore()},methods:{init:function(){this.token&&this.infoLike()},getPostInfo:function(t){var e=this;this.$store.state.refreshPost=!0,(0,i.getPostInfo)({id:t}).then((function(t){e.postInfo=t.data})).finally((function(){e.isLoad=!0}))},onLoadMore:function(){this.getPostPage(y(y({},this.searchData),{},{page:this.searchData.page+1}))},initAddComment:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;!t||this.token?(this.showAddComment=t,this.commentContent="",this.replyCommentId="",this.replyNickname="",n&&(this.replyCommentId=n.id,this.replyNickname=n.user&&n.user.nickName),setTimeout((function(){e.addCommentFocus=t}),200)):(0,r.httpLogin)()},like:function(){var e=this;this.token?(this.$store.state.loading=!0,(0,i.addCollect)({postId:this.postInfo.id}).then((function(n){t.showToast({title:"收藏成功",icon:"none"}),e.lickInfo=n.data,e.$store.state.refreshPost=!0})).finally((function(){e.$store.state.loading=!1}))):(0,r.httpLogin)()},infoLike:function(){var t=this;console.log(this),(0,i.infoCollect)({postId:this.postInfo.id||this.postId}).then((function(e){t.lickInfo=e.data||{}}))},delLike:function(){var e=this;this.token?(this.$store.state.loading=!0,(0,i.deleteCollect)({postId:this.lickInfo.id}).then((function(n){t.showToast({title:"已取消收藏",icon:"none"}),e.lickInfo=null,e.$store.state.refreshPost=!0})).finally((function(){e.$store.state.loading=!1}))):(0,r.httpLogin)()},addCommentOrReply:function(){var e=this;""!=this.commentContent?(this.$store.state.loading=!0,(0,i.addReply)({postId:this.postInfo.id,content:this.commentContent,replyId:this.replyCommentId}).then((function(n){e.showAddComment=!1,e.commentContent="";var o="评论成功";e.replyCommentId&&(e.replyCommentId="",e.replyNickname="",o="回复成功"),t.showToast({title:o,icon:"none"}),e.getReplyPage(y(y({},e.replySearchForm),{},{page:1})),e.$store.state.refreshPost=!0})).finally((function(){e.$store.state.loading=!1}))):t.showToast({title:"评论内容不能为空",icon:"none"})},getReplyPage:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.replySearchForm;(0,i.getReplyPage)(y({postId:this.postInfo.id},e)).then((function(n){t.replySearchForm=e;var o=n.data.list;if(1!=e.page){o=l(t.replyList).concat(o)}t.replyTotal=n.data.pagination.total,t.replyList=o,t.replyTotal<=t.replyList.length?t.loadStatus="nomore":t.loadStatus="loadmore"}))},navToReply:function(){var e=this;return c(o.default.mark((function n(){var i,r,s;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=0,n.next=3,e.getDomHeight("postdetailpage");case 3:return r=n.sent,n.next=6,e.getDomHeight("reply");case 6:if(s=n.sent,i=r-s-e.CustomBar,!(i<400)){n.next=10;break}return n.abrupt("return");case 10:t.pageScrollTo({scrollTop:i,duration:180});case 11:case"end":return n.stop()}}),n)})))()},getDomHeight:function(e){var n=this;return new Promise((function(o){t.createSelectorQuery().in(n).select("#"+e).boundingClientRect((function(t){o(t&&t.height||0)})).exec()}))},editStatus:function(){var e=this;t.showActionSheet({itemList:this.postStatusText,success:function(n){var o=n.tapIndex;e.$store.state.loading=!0,(0,i.updatePostStatus)({id:e.postId,status:o}).then((function(n){t.showToast({title:"修改成功",icon:"none"}),e.$set(e.postInfo,"status",o),e.$store.state.refreshPost=!0})).finally((function(){e.$store.state.loading=!1}))},fail:function(t){console.log(t.errMsg)}})},editTop:function(e){var n=this,o=e.top,r=this;t.showActionSheet({itemList:[1===o?"取消置顶":"置顶"],success:function(e){r.$store.state.loading=!0,(0,i.updatePostTop)({id:n.postId,top:+!o}).then((function(e){t.showToast({title:"修改成功",icon:"none"}),r.$set(r.postInfo,"top",+!o),r.$store.state.refreshPost=!0})).finally((function(){r.$store.state.loading=!1}))},fail:function(t){console.log(t.errMsg)}})},editPost:function(e){this.$store.commit("setPostInfo",e),t.navigateTo({url:"./post?id="+e.id})},share:function(){t.showShareMenu()},load:function(){console.log("dom 树加载完毕")},ready:function(t){console.log("ready 事件触发：",t)},imgtap:function(t){console.log("imgtap 事件触发：",t)},linktap:function(t){console.log("linktap 事件触发：",t)}}};e.default=v}).call(this,n("543d")["default"])},a83c:function(t,e,n){"use strict";n.r(e);var o=n("ed90"),i=n("d307");for(var r in i)"default"!==r&&function(t){n.d(e,t,(function(){return i[t]}))}(r);n("5d1c");var s,a=n("f0c5"),u=Object(a["a"])(i["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],s);e["default"]=u.exports},d307:function(t,e,n){"use strict";n.r(e);var o=n("5f4c"),i=n.n(o);for(var r in o)"default"!==r&&function(t){n.d(e,t,(function(){return o[t]}))}(r);e["default"]=i.a},ed90:function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){return o}));var o={mpHtml:function(){return Promise.all([n.e("common/vendor"),n.e("components/mp-html/mp-html")]).then(n.bind(null,"0809"))},uIcon:function(){return n.e("uview-ui/components/u-icon/u-icon").then(n.bind(null,"7163"))},uLoadmore:function(){return n.e("uview-ui/components/u-loadmore/u-loadmore").then(n.bind(null,"aacf"))},uButton:function(){return n.e("uview-ui/components/u-button/u-button").then(n.bind(null,"96a3"))},uLoading:function(){return n.e("uview-ui/components/u-loading/u-loading").then(n.bind(null,"f3a1"))}},i=function(){var t=this,e=t.$createElement,n=(t._self._c,t._f("dateMonth")(t.postInfo.departureTime));t.$mp.data=Object.assign({},{$root:{f0:n}})},r=[]},f98b:function(t,e,n){}},[["299f","common/runtime","common/vendor"]]]);