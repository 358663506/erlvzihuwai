<template>
	<div class="demo-upsert">
		<cl-upsert ref="upsertRef" v-bind="upsert" @opened="opened" :on-open="onOpen">
			<template #slot-on>
				<test />
			</template>

			<template #slot-next>
				<el-button size="small" @click="onNext">Next</el-button>
			</template>
		</cl-upsert>
	</div>
</template>

<script lang="ts">
import { Upsert, UpsertItem, UpsertRef } from "@/types";
import { ElMessage } from "element-plus";
import { defineComponent, reactive, ref } from "vue";
import Test from "./render/test.vue";

export default defineComponent({
	components: {
		Test
	},

	setup() {
		const upsertRef = ref<UpsertRef>();

		const list = ref<any[]>([]);

		const a = ref([1]);

		const upsert = ref<Upsert>({
			items: [
				{
					label: "测试hook",
					prop: "hook",
					hook: {
						bind: ["split", "number"],
						submit: "join"
					},
					component: {
						name: "el-checkbox-group",
						options: [
							{
								label: "景天",
								value: 1
							},
							{
								label: "李逍遥",
								value: 2
							},
							{
								label: "宇文拓",
								value: 3
							}
						]
					}
				},
				{
					type: "tabs",
					value: "base",
					props: {
						labels: [
							{
								label: "基本信息",
								value: "base"
							},
							{
								label: "金融",
								value: "financial"
							},
							{
								label: "工作",
								value: "work"
							}
						]
					}
				},
				{
					label: {
						text: "姓名",
						icon: "el-icon-question",
						tip: "姓名是汉语词语，拼音是 xìng míng ，意思是由姓和名组成"
					},
					prop: "name",
					group: "base",
					collapse: false,
					component: {
						name: "el-input"
					},
					required: true
				},
				{
					label: "存款",
					prop: "price",
					value: 0,
					group: "financial",
					component: {
						name: "el-input-number"
					},
					append({ h }: any) {
						return h("p", "元");
					},
					rules: {
						required: true,
						message: "存款不能为空"
					}
				},
				{
					label: "公司",
					prop: "company",
					value: "cool",
					group: "work",
					component: {
						name: "el-input"
					}
				},
				{
					label: "状态",
					prop: "status",
					value: 1,
					component: {
						name: "el-radio-group",
						options: [
							{
								label: "启用",
								value: 1
							},
							{
								label: "禁用",
								value: 0
							}
						],
						props: {
							onChange(v: any) {
								upsertRef.value?.toggleItem("remark", v == 1);
							}
						}
					}
				},
				{
					label: "备注",
					prop: "remark",
					component: {
						name: "el-input"
					}
				}
			],
			op: {
				buttons: [
					"close",
					"save",
					"slot-next",
					{
						label: "提示",
						onClick() {
							ElMessage.success("保存成功");
						}
					}
				]
			}
		});

		function opened(isEdit: boolean) {
			console.log(isEdit);
		}

		function onOpen(isEdit: boolean) {
			upsertRef.value?.setTitle(isEdit ? "edit" : "add");
		}

		function onNext() {
			upsertRef.value?.changeTab("work").catch((err) => {
				console.error(err);
			});
		}

		return {
			a,
			list,
			upsert,
			upsertRef,
			opened,
			onOpen,
			onNext
		};
	}
});
</script>

<style lang="scss" scoped>
.demo-upsert {
}
</style>
