import { Browser, Crud, Mitt } from "@/types";
import { ref, watch, reactive, inject } from "vue";
import { isEmpty } from "../utils";

export function useForm(props: any) {
	const setFormData = () => {
		const data = reactive<any>(props.modelValue || {});

		watch(
			() => props.modelValue,
			(val: any) => {
				for (const i in data) {
					if (isEmpty(val[i])) {
						delete data[i];
					} else {
						data[i] = val[i];
					}
				}
			}
		);

		return data;
	};

	return {
		setFormData
	};
}

export function useRefs() {
	const refs = ref<any>({});
	const setRefs = (index: number) => (el: HTMLElement) => {
		refs.value[index] = el;
	};

	return { refs, setRefs };
}

export function useTools() {
	const browser = inject("browser") as Browser;

	return { browser };
}

export function useCore() {
	const crudConf = inject<any>("crudConf");
	const mitt = inject("mitt") as Mitt;
	const crud = inject("crud") as Crud;

	return {
		mitt,
		crudConf,
		crud
	};
}
